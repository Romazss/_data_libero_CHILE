<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Biblioteca de Datos Abiertos de Chile ‚Äî Portal de Monitoreo</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üá®üá±</text></svg>">
  <script>window.API_BASE="http://localhost:5001"; window.SOCKET_URL=window.API_BASE;</script>
</head>
<body>
  <!-- Header mejorado -->
  <header class="container">
    <div class="header-content">
      <div class="title-section">
        <h1>üá®üá± Biblioteca de Datos Abiertos</h1>
        <p class="subtitle">Monitoreo en tiempo real de datasets p√∫blicos de Chile</p>
      </div>
      
      <!-- Notificaciones -->
      <div class="notifications-section">
        <button class="notification-btn" id="notificationBtn">
          <span class="notification-icon">üîî</span>
          <span class="notification-badge" id="notificationBadge">0</span>
        </button>
        <div class="connection-status" id="connectionStatusTop">
          <span class="status-indicator offline" id="statusIndicatorTop"></span>
          <span class="status-text" id="statusTextTop">Desconectado</span>
        </div>
      </div>
      
      <div class="stats-summary" id="statsSummary">
        <div class="stat-card">
          <span class="stat-number" id="totalDatasets">-</span>
          <span class="stat-label">Datasets</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="availableDatasets">-</span>
          <span class="stat-label">Disponibles</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="avgLatency">-</span>
          <span class="stat-label">Latencia promedio</span>
        </div>
      </div>
    </div>
    
    <!-- Toolbar expandida -->
    <div class="toolbar">
      <div class="toolbar-section">
        <button id="refreshBtn" class="btn btn-primary">
          <span class="btn-icon">üîÑ</span>
          Actualizar
        </button>
        
        <button id="forceCheckBtn" class="btn btn-secondary">
          <span class="btn-icon">‚ö°</span>
          Verificar Ahora
        </button>
      </div>
      
      <div class="toolbar-section">
        <label class="input-group">
          <span>Categor√≠a:</span>
          <select id="categoryFilter">
            <option value="">Todas</option>
          </select>
        </label>
        
        <label class="input-group">
          <span>Estado:</span>
          <select id="statusFilter">
            <option value="">Todos</option>
            <option value="up">Disponibles</option>
            <option value="down">No disponibles</option>
          </select>
        </label>
      </div>
      
      <div class="toolbar-section">
        <label class="input-group">
          <span>Auto-refresco:</span>
          <select id="autoRefresh">
            <option value="0">Off</option>
            <option value="30">30s</option>
            <option value="60" selected>60s</option>
            <option value="300">5min</option>
          </select>
        </label>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="container">
    <!-- Indicador de carga -->
    <div id="loadingIndicator" class="loading-indicator hidden">
      <div class="spinner"></div>
      <span>Cargando datos...</span>
    </div>
    
    <!-- Tabla de datasets -->
    <div class="table-container">
      <table id="table" class="table">
        <thead>
          <tr>
            <th>Dataset</th>
            <th>Categor√≠a</th>
            <th>Estado</th>
            <th>Latencia</th>
            <th>HTTP</th>
            <th>√öltima verificaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    
    <!-- Mensaje de error -->
    <div id="error" class="error hidden"></div>
    
    <!-- Mensaje cuando no hay datos -->
    <div id="noData" class="no-data hidden">
      <div class="no-data-content">
        <span class="no-data-icon">üìä</span>
        <h3>No hay datos disponibles</h3>
        <p>No se encontraron datasets que coincidan con los filtros aplicados.</p>
        <button id="clearFiltersBtn" class="btn btn-primary">Limpiar filtros</button>
      </div>
    </div>
  </main>

  <!-- Analytics Dashboard -->
  <section class="container analytics-section" id="analyticsSection">
    <div class="analytics-header">
      <h2>üìä Analytics Dashboard</h2>
      <div class="analytics-controls">
        <label>
          Per√≠odo:
          <select id="analyticsPeriod">
            <option value="24">√öltimas 24h</option>
            <option value="168">√öltima semana</option>
            <option value="720">√öltimo mes</option>
          </select>
        </label>
        <button id="refreshAnalytics" class="btn btn-secondary">Actualizar</button>
        <button id="generateReport" class="btn btn-primary">Generar Reporte</button>
      </div>
    </div>
    
    <!-- M√©tricas principales -->
    <div class="analytics-metrics">
      <div class="metric-card">
        <div class="metric-icon">‚è±Ô∏è</div>
        <div class="metric-content">
          <h4>Uptime Promedio</h4>
          <span class="metric-value" id="analyticsUptime">-</span>
          <span class="metric-unit">%</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">üöÄ</div>
        <div class="metric-content">
          <h4>Latencia Promedio</h4>
          <span class="metric-value" id="analyticsLatency">-</span>
          <span class="metric-unit">ms</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">üéØ</div>
        <div class="metric-content">
          <h4>Score de Confiabilidad</h4>
          <span class="metric-value" id="analyticsReliability">-</span>
          <span class="metric-unit">/100</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">üìà</div>
        <div class="metric-content">
          <h4>Verificaciones</h4>
          <span class="metric-value" id="analyticsChecks">-</span>
          <span class="metric-unit">total</span>
        </div>
      </div>
    </div>
    
    <!-- Gr√°ficos y tablas -->
    <div class="analytics-grid">
      <!-- Top Datasets -->
      <div class="analytics-card">
        <h3>üèÜ Mejores Datasets</h3>
        <div id="topDatasetsContent" class="analytics-content">
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>Cargando...</span>
          </div>
        </div>
      </div>
      
      <!-- Datasets Problem√°ticos -->
      <div class="analytics-card">
        <h3>‚ö†Ô∏è Datasets Problem√°ticos</h3>
        <div id="problematicDatasetsContent" class="analytics-content">
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>Cargando...</span>
          </div>
        </div>
      </div>
      
      <!-- Analytics por Categor√≠a -->
      <div class="analytics-card full-width">
        <h3>üìÇ Analytics por Categor√≠a</h3>
        <div id="categoryAnalyticsContent" class="analytics-content">
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>Cargando...</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Reportes -->
    <div class="reports-section">
      <h3>üìã Reportes</h3>
      <div class="reports-actions">
        <button id="generateDailyReport" class="btn btn-outline">Reporte Diario</button>
        <button id="generateWeeklyReport" class="btn btn-outline">Reporte Semanal</button>
        <button id="exportAnalytics" class="btn btn-outline">Exportar Datos</button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="container footer">
    <div class="footer-content">
      <div class="footer-section">
        <small>
          Fase 2 ¬∑ API Robusta ¬∑ 
          <a href="https://github.com/Romazss/_data_libero_CHILE" target="_blank" rel="noreferrer">
            Repositorio GitHub
          </a>
        </small>
      </div>
      
      <div class="footer-section">
        <div class="api-status" id="apiStatus">
          <span class="status-indicator" id="statusIndicator"></span>
          <span id="statusText">Conectando...</span>
        </div>
      </div>
      
      <div class="footer-section">
        <span id="lastUpdated" class="last-updated">-</span>
      </div>
    </div>
  </footer>

  <!-- Modal para hist√≥rico de dataset -->
    <!-- Modal de Notificaciones -->
  <div id="notificationsModal" class="modal hidden">
    <div class="modal-content notifications-modal">
      <div class="modal-header">
        <h3>üîî Notificaciones</h3>
        <div class="modal-header-actions">
          <button id="clearNotificationsBtn" class="btn btn-secondary">Limpiar todo</button>
          <button id="closeNotificationsModal" class="close-btn">√ó</button>
        </div>
      </div>
      <div class="modal-body">
        <div id="notificationsContent" class="notifications-content">
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>Cargando notificaciones...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Hist√≥rico (existing) -->
  <div id="historyModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="historyModalTitle">Hist√≥rico del Dataset</h3>
        <button id="closeHistoryModal" class="close-btn">√ó</button>
      </div>
      <div class="modal-body">
        <div class="history-controls">
          <label>
            Per√≠odo:
            <select id="historyPeriod">
              <option value="1">√öltima hora</option>
              <option value="6">√öltimas 6 horas</option>
              <option value="24" selected>√öltimo d√≠a</option>
              <option value="168">√öltima semana</option>
            </select>
          </label>
        </div>
        <div id="historyContent" class="history-content">
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>Cargando hist√≥rico...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay para modal -->
  <div id="modalOverlay" class="modal-overlay hidden"></div>

  <!-- Socket.IO Client -->
  <script src="http://localhost:5001/socket.io/socket.io.js"></script>
  <script src="app.js"></script>
</body>
</html>